{"version":3,"file":"Setup.js","names":["MuxVideoInputSetup","Component","uniqueId","token","props","secrets","secretKey","enableSignedUrls","signingKeyId","signingKeyPrivate","isLoading","error","React","createRef","event","setState","currentTarget","value","checked","preventDefault","state","saveSecrets","err","console","hasValidSigningKeys","haveValidSigningKeys","createSigningKeys","data","id","private_key","log","message","onSave","componentDidMount","firstField","current","focus","render","position","handleOnSubmit","tokenInputId","handleTokenChanged","secretKeyInputId","handleSecretKeyChanged","enableSignedUrlsInputId","handleEnableSignedUrls","display","handleSaveToken","onCancel"],"sources":["../../src/components/Setup.tsx"],"sourcesContent":["import {Box, Button, Card, Checkbox, Code, Flex, Inline, Stack, Text, TextInput} from '@sanity/ui'\nimport {uniqueId} from 'lodash'\nimport FormField from 'part:@sanity/components/formfields/default'\nimport React, {Component} from 'react'\n\nimport {createSigningKeys, haveValidSigningKeys, saveSecrets} from '../actions/secrets'\nimport type {Secrets} from '../util/types'\n\nexport interface Props {\n  onSave: (secrets: Secrets) => void\n  onCancel: () => void\n  secrets: Secrets | null\n}\ninterface State extends Secrets {\n  isLoading: boolean\n  error: string | null\n}\nclass MuxVideoInputSetup extends Component<Props, State> {\n  tokenInputId = uniqueId('MuxTokenInput')\n  secretKeyInputId = uniqueId('MuxSecretInput')\n  enableSignedUrlsInputId = uniqueId('MuxEnableSignedUrlsInput')\n\n  state: State = {\n    token: this.props.secrets?.token ?? null,\n    secretKey: this.props.secrets?.secretKey ?? null,\n    enableSignedUrls: this.props.secrets?.enableSignedUrls ?? false,\n    signingKeyId: this.props.secrets?.signingKeyId ?? null,\n    signingKeyPrivate: this.props.secrets?.signingKeyPrivate ?? null,\n    isLoading: false,\n    error: null,\n  }\n\n  firstField = React.createRef<HTMLInputElement>()\n\n  componentDidMount() {\n    this.firstField.current!.focus()\n  }\n\n  handleTokenChanged: React.FormEventHandler<HTMLInputElement> = (event) => {\n    this.setState({token: event.currentTarget.value})\n  }\n\n  handleSecretKeyChanged: React.FormEventHandler<HTMLInputElement> = (event) => {\n    this.setState({secretKey: event.currentTarget.value})\n  }\n\n  handleEnableSignedUrls: React.FormEventHandler<HTMLInputElement> = (event) =>\n    this.setState({enableSignedUrls: event.currentTarget.checked})\n\n  handleOnSubmit: React.FormEventHandler<HTMLFormElement> = (event) => {\n    event.preventDefault()\n  }\n\n  handleSaveToken = async () => {\n    this.setState({isLoading: true})\n\n    const {token, secretKey, enableSignedUrls} = this.state\n    let {signingKeyId, signingKeyPrivate} = this.state\n\n    try {\n      await saveSecrets(token!, secretKey!, enableSignedUrls, signingKeyId!, signingKeyPrivate!)\n    } catch (err) {\n      console.error('Error while trying to save secrets:', err) // eslint-disable-line no-console\n      this.setState({\n        isLoading: false,\n        error: 'Something went wrong saving the token. See console.error for more info.',\n      })\n      return\n    }\n\n    if (enableSignedUrls) {\n      const hasValidSigningKeys = await haveValidSigningKeys(signingKeyId!, signingKeyPrivate!)\n\n      if (!hasValidSigningKeys) {\n        try {\n          const {data} = await createSigningKeys()\n          signingKeyId = data.id\n          signingKeyPrivate = data.private_key\n          await saveSecrets(token!, secretKey!, enableSignedUrls, signingKeyId, signingKeyPrivate)\n        } catch (err: any) {\n          // eslint-disable-next-line no-console\n          console.log('Error while creating and saving signing key:', err?.message)\n          this.setState({error: err?.message!})\n        }\n      }\n    }\n\n    this.setState({isLoading: false})\n\n    this.props.onSave({token, secretKey, enableSignedUrls, signingKeyId, signingKeyPrivate})\n  }\n\n  render() {\n    const {error, isLoading} = this.state\n\n    return (\n      <Box\n        paddingRight={4}\n        paddingLeft={4}\n        paddingBottom={4}\n        paddingTop={4}\n        style={{position: 'relative'}}\n      >\n        <form onSubmit={this.handleOnSubmit}>\n          <Stack space={4}>\n            {!this.state.token && (\n              <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"primary\">\n                <Stack space={3}>\n                  <Text size={1}>\n                    To set up a new access token, go to your{' '}\n                    <a\n                      href=\"https://dashboard.mux.com/settings/access-tokens\"\n                      target=\"_blank\"\n                      rel=\"noreferrer noopener\"\n                    >\n                      account on mux.com\n                    </a>\n                    .\n                  </Text>\n                  <Text size={1}>\n                    The access token needs permissions: <strong>Mux Video </strong>\n                    (Full Access) and <strong>Mux Data</strong> (Read)\n                    <br />\n                    The credentials will be stored safely in a hidden document only available to\n                    editors.\n                  </Text>\n                </Stack>\n              </Card>\n            )}\n            <FormField\n              changeIndicator={false}\n              label=\"Access Token\"\n              labelFor={this.tokenInputId}\n              level={0}\n            >\n              <TextInput\n                id={this.tokenInputId}\n                ref={this.firstField}\n                onChange={this.handleTokenChanged}\n                type=\"text\"\n                value={this.state.token || ''}\n              />\n            </FormField>\n            <FormField\n              changeIndicator={false}\n              label=\"Secret Key\"\n              labelFor={this.secretKeyInputId}\n              level={0}\n            >\n              <TextInput\n                id={this.secretKeyInputId}\n                onChange={this.handleSecretKeyChanged}\n                type=\"text\"\n                value={this.state.secretKey || ''}\n              />\n            </FormField>\n\n            <Stack space={4}>\n              <Flex align=\"center\">\n                <Checkbox\n                  id={this.enableSignedUrlsInputId}\n                  onChange={this.handleEnableSignedUrls}\n                  checked={this.state.enableSignedUrls || false}\n                  style={{display: 'block'}}\n                />\n                <Box flex={1} paddingLeft={3}>\n                  <Text>\n                    <label htmlFor={this.enableSignedUrlsInputId}>Enable Signed Urls</label>\n                  </Text>\n                </Box>\n              </Flex>\n              {this.state.signingKeyId && this.state.enableSignedUrls ? (\n                <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"caution\">\n                  <Stack space={3}>\n                    <Text size={1}>The signing key ID that Sanity will use is:</Text>\n                    <Code size={1}>{this.state.signingKeyId}</Code>\n                    <Text size={1}>\n                      This key is only used for previewing content in the Sanity UI.\n                      <br />\n                      You should generate a different key to use in your application server.\n                    </Text>\n                  </Stack>\n                </Card>\n              ) : null}\n            </Stack>\n\n            <Inline space={2}>\n              <Button\n                text=\"Save\"\n                loading={isLoading}\n                tone=\"primary\"\n                mode=\"default\"\n                onClick={this.handleSaveToken}\n              />\n\n              <Button text=\"Cancel\" tone=\"primary\" mode=\"bleed\" onClick={this.props.onCancel} />\n            </Inline>\n            {error && (\n              <Card padding={[3, 3, 3]} radius={2} shadow={1} tone=\"critical\">\n                <Text>{error}</Text>\n              </Card>\n            )}\n          </Stack>\n        </form>\n      </Box>\n    )\n  }\n}\n\nexport default MuxVideoInputSetup\n"],"mappings":"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"}
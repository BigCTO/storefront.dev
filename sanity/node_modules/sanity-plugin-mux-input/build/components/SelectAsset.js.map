{"version":3,"file":"SelectAsset.js","names":["PER_PAGE","createQuery","start","end","SelectAssets","onSelect","secrets","pageNoRef","useRef","useState","isLastPage","setLastPage","isLoading","setLoading","assets","setAssets","fetchPage","useCallback","pageNo","client","fetch","then","result","length","prev","concat","finally","handleSelect","id","selected","find","doc","_id","TypeError","handleLoadMore","current","useEffect"],"sources":["../../src/components/SelectAsset.tsx"],"sourcesContent":["import React, {useCallback, useEffect, useRef, useState} from 'react'\n\nimport client from '../clients/SanityClient'\nimport type {Secrets, VideoAssetDocument} from '../util/types'\nimport VideoSource, {type Props as VideoSourceProps} from './VideoSource'\n\nconst PER_PAGE = 20\n\nfunction createQuery(start = 0, end = PER_PAGE) {\n  return /* groq */ `*[_type == \"mux.videoAsset\"] | order(_updatedAt desc) [${start}...${end}] {_id, playbackId, thumbTime, data}`\n}\n\nexport interface Props {\n  onSelect: (asset: VideoAssetDocument) => void\n  secrets: Secrets\n}\n\nexport default function SelectAssets({onSelect, secrets}: Props) {\n  const pageNoRef = useRef(0)\n  const [isLastPage, setLastPage] = useState(false)\n  const [isLoading, setLoading] = useState(false)\n  const [assets, setAssets] = useState<VideoAssetDocument[]>([])\n\n  const fetchPage = useCallback((pageNo: number) => {\n    const start = pageNo * PER_PAGE\n    const end = start + PER_PAGE\n    setLoading(true)\n    return client\n      .fetch(createQuery(start, end))\n      .then((result: VideoAssetDocument[]) => {\n        setLastPage(result.length < PER_PAGE)\n        setAssets((prev) => prev.concat(result))\n      })\n      .finally(() => setLoading(false))\n  }, [])\n  const handleSelect = useCallback<VideoSourceProps['onSelect']>(\n    (id) => {\n      const selected = assets.find((doc) => doc._id === id)\n      if (!selected) {\n        throw new TypeError(`Failed to find video asset with id: ${id}`)\n      }\n      onSelect(selected)\n    },\n    [assets, onSelect]\n  )\n  const handleLoadMore = useCallback<VideoSourceProps['onLoadMore']>(() => {\n    fetchPage(++pageNoRef.current)\n  }, [fetchPage])\n\n  useEffect(() => void fetchPage(pageNoRef.current), [fetchPage])\n\n  return (\n    <VideoSource\n      onSelect={handleSelect}\n      assets={assets}\n      isLastPage={isLastPage}\n      isLoading={isLoading}\n      onLoadMore={handleLoadMore}\n      secrets={secrets}\n    />\n  )\n}\n"],"mappings":";;;;;;;AAAA;;AAEA;;AAEA;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,QAAQ,GAAG,EAAjB;;AAEA,SAASC,WAAT,GAAgD;EAAA,IAA3BC,KAA2B,uEAAnB,CAAmB;EAAA,IAAhBC,GAAgB,uEAAVH,QAAU;EAC9C;IAAO;IAAP,mEAA4EE,KAA5E,gBAAuFC,GAAvF;EAAA;AACD;;AAOc,SAASC,YAAT,OAAkD;EAAA,IAA3BC,QAA2B,QAA3BA,QAA2B;EAAA,IAAjBC,OAAiB,QAAjBA,OAAiB;EAC/D,IAAMC,SAAS,GAAG,IAAAC,aAAA,EAAO,CAAP,CAAlB;;EACA,gBAAkC,IAAAC,eAAA,EAAS,KAAT,CAAlC;EAAA;EAAA,IAAOC,UAAP;EAAA,IAAmBC,WAAnB;;EACA,iBAAgC,IAAAF,eAAA,EAAS,KAAT,CAAhC;EAAA;EAAA,IAAOG,SAAP;EAAA,IAAkBC,UAAlB;;EACA,iBAA4B,IAAAJ,eAAA,EAA+B,EAA/B,CAA5B;EAAA;EAAA,IAAOK,MAAP;EAAA,IAAeC,SAAf;;EAEA,IAAMC,SAAS,GAAG,IAAAC,kBAAA,EAAaC,MAAD,IAAoB;IAChD,IAAMhB,KAAK,GAAGgB,MAAM,GAAGlB,QAAvB;IACA,IAAMG,GAAG,GAAGD,KAAK,GAAGF,QAApB;IACAa,UAAU,CAAC,IAAD,CAAV;IACA,OAAOM,qBAAA,CACJC,KADI,CACEnB,WAAW,CAACC,KAAD,EAAQC,GAAR,CADb,EAEJkB,IAFI,CAEEC,MAAD,IAAkC;MACtCX,WAAW,CAACW,MAAM,CAACC,MAAP,GAAgBvB,QAAjB,CAAX;MACAe,SAAS,CAAES,IAAD,IAAUA,IAAI,CAACC,MAAL,CAAYH,MAAZ,CAAX,CAAT;IACD,CALI,EAMJI,OANI,CAMI,MAAMb,UAAU,CAAC,KAAD,CANpB,CAAP;EAOD,CAXiB,EAWf,EAXe,CAAlB;EAYA,IAAMc,YAAY,GAAG,IAAAV,kBAAA,EAClBW,EAAD,IAAQ;IACN,IAAMC,QAAQ,GAAGf,MAAM,CAACgB,IAAP,CAAaC,GAAD,IAASA,GAAG,CAACC,GAAJ,KAAYJ,EAAjC,CAAjB;;IACA,IAAI,CAACC,QAAL,EAAe;MACb,MAAM,IAAII,SAAJ,+CAAqDL,EAArD,EAAN;IACD;;IACDvB,QAAQ,CAACwB,QAAD,CAAR;EACD,CAPkB,EAQnB,CAACf,MAAD,EAAST,QAAT,CARmB,CAArB;EAUA,IAAM6B,cAAc,GAAG,IAAAjB,kBAAA,EAA4C,MAAM;IACvED,SAAS,CAAC,EAAET,SAAS,CAAC4B,OAAb,CAAT;EACD,CAFsB,EAEpB,CAACnB,SAAD,CAFoB,CAAvB;EAIA,IAAAoB,gBAAA,EAAU,MAAM,KAAKpB,SAAS,CAACT,SAAS,CAAC4B,OAAX,CAA9B,EAAmD,CAACnB,SAAD,CAAnD;EAEA,oBACE,6BAAC,oBAAD;IACE,QAAQ,EAAEW,YADZ;IAEE,MAAM,EAAEb,MAFV;IAGE,UAAU,EAAEJ,UAHd;IAIE,SAAS,EAAEE,SAJb;IAKE,UAAU,EAAEsB,cALd;IAME,OAAO,EAAE5B;EANX,EADF;AAUD"}
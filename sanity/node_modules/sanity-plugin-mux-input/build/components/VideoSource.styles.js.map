{"version":3,"file":"VideoSource.styles.js","names":["mediaDimensions","aspect","ImageLoader","memo","alt","src","height","width","suspend","img","Image","decoding","decode","VideoMediaPreview","styled","MediaPreview","VideoMediaPreviewSignedSubtitle","solo","marginTop","undefined","marginBottom","PosterImage","asset","secrets","getPosterSrc","fit_mode","subtitle","useMemo","isSigned","VideoThumbnail","useErrorBoundary","ErrorBoundary","didCatch","error","Math","round","getPlaybackPolicy","message","position","display","justifyContent","alignItems","top","left","right","bottom","ThumbGrid","Grid","CardLoadMore","Card"],"sources":["../../src/components/VideoSource.styles.tsx"],"sourcesContent":["import {MediaPreview} from '@sanity/base/components'\nimport {LockIcon, UnknownIcon} from '@sanity/icons'\nimport {Box, Card, Grid, Inline} from '@sanity/ui'\nimport React, {memo, Suspense, useMemo} from 'react'\nimport styled from 'styled-components'\nimport {suspend} from 'suspend-react'\nimport {useErrorBoundary} from 'use-error-boundary'\n\nimport {getPlaybackPolicy} from '../util/getPlaybackPolicy'\nimport {getPosterSrc} from '../util/getPosterSrc'\nimport {isSigned} from '../util/isSigned'\nimport type {Secrets, VideoAssetDocument} from '../util/types'\n\nconst mediaDimensions = {aspect: 16 / 9}\n\ninterface ImageLoaderProps {\n  alt: string\n  src: string\n  height: number\n  width: number\n}\nconst ImageLoader = memo(function ImageLoader({alt, src, height, width}: ImageLoaderProps) {\n  suspend(async () => {\n    const img = new Image(width, height)\n    img.decoding = 'async'\n    img.src = src\n    await img.decode()\n  }, ['sanity-plugin-mux-input', 'image', src])\n\n  return <img alt={alt} src={src} height={height} width={width} />\n})\n\nconst VideoMediaPreview = styled(MediaPreview)`\n  img {\n    object-fit: cover;\n  }\n`\n\ninterface VideoMediaPreviewSignedSubtitleProps {\n  solo?: boolean\n}\nconst VideoMediaPreviewSignedSubtitle = ({solo}: VideoMediaPreviewSignedSubtitleProps) => {\n  return (\n    <Inline\n      space={1}\n      style={{marginTop: solo ? '-1.35em' : undefined, marginBottom: solo ? undefined : '0.35rem'}}\n    >\n      <LockIcon />\n      Signed playback policy\n    </Inline>\n  )\n}\n\ninterface PosterImageProps extends Omit<ImageLoaderProps, 'src' | 'alt'> {\n  asset: VideoAssetDocument\n  secrets: Secrets\n}\nconst PosterImage = ({asset, height, width, secrets}: PosterImageProps) => {\n  const src = getPosterSrc({asset, secrets, height, width, fit_mode: 'smartcrop'})\n  const subtitle = useMemo(\n    () => (isSigned(asset, secrets) ? <VideoMediaPreviewSignedSubtitle solo /> : undefined),\n    [asset, secrets]\n  )\n\n  // eslint-disable-next-line no-warning-comments\n  // @TODO support setting the alt text in the schema, like how we deal with images\n  return (\n    <VideoMediaPreview\n      mediaDimensions={mediaDimensions}\n      subtitle={subtitle}\n      title={<>{null}</>}\n      media={<ImageLoader alt=\"\" src={src} height={height} width={width} />}\n    />\n  )\n}\n\nexport interface VideoThumbnailProps extends Omit<PosterImageProps, 'height'> {\n  width: number\n}\nexport const VideoThumbnail = memo(function VideoThumbnail({\n  asset,\n  secrets,\n  width,\n}: VideoThumbnailProps) {\n  const {ErrorBoundary, didCatch, error} = useErrorBoundary()\n  const height = Math.round((width * 9) / 16)\n  const subtitle = useMemo(\n    () => (getPlaybackPolicy(asset) === 'signed' ? <VideoMediaPreviewSignedSubtitle /> : undefined),\n    [asset]\n  )\n\n  if (didCatch) {\n    return (\n      <VideoMediaPreview\n        subtitle={error.message}\n        mediaDimensions={mediaDimensions}\n        title=\"Error when loading thumbnail\"\n        media={\n          <Card radius={2} height=\"fill\" style={{position: 'relative', width: '100%'}}>\n            <Box\n              style={{\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n                position: 'absolute',\n                top: 0,\n                left: 0,\n                right: 0,\n                bottom: 0,\n              }}\n            >\n              <UnknownIcon />\n            </Box>\n          </Card>\n        }\n      />\n    )\n  }\n\n  return (\n    <ErrorBoundary>\n      <Suspense\n        fallback={\n          <VideoMediaPreview\n            isPlaceholder\n            title=\"Loading thumbnail...\"\n            subtitle={subtitle}\n            mediaDimensions={mediaDimensions}\n          />\n        }\n      >\n        <PosterImage asset={asset} secrets={secrets} height={height} width={width} />\n      </Suspense>\n    </ErrorBoundary>\n  )\n})\n\nexport const ThumbGrid = styled(Grid)`\n  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));\n`\n\nexport const CardLoadMore = styled(Card)`\n  border-top: 1px solid var(--card-border-color);\n  position: sticky;\n  bottom: 0;\n  z-index: 200;\n`\n"],"mappings":"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"}
{"version":3,"file":"upChunkObservable.js","names":["createUpChunkObservable","uuid","uploadUrl","source","Observable","subscriber","upchunk","UpChunk","createUpload","endpoint","file","chunkSize","successHandler","next","type","id","complete","errorHandler","data","error","Error","detail","message","progressHandler","percent","offlineHandler","pause","onlineHandler","resume","on","abort"],"sources":["../../src/clients/upChunkObservable.ts"],"sourcesContent":["import * as UpChunk from '@mux/upchunk'\nimport {Observable} from 'rxjs'\n\nexport function createUpChunkObservable(uuid: string, uploadUrl: string, source: File) {\n  return new Observable((subscriber) => {\n    const upchunk = UpChunk.createUpload({\n      endpoint: uploadUrl,\n      file: source,\n      chunkSize: 30720, // Uploads the file in 30 MB chunks\n    })\n\n    const successHandler = () => {\n      subscriber.next({\n        type: 'success',\n        id: uuid,\n      })\n      subscriber.complete()\n    }\n\n    const errorHandler = (data: CustomEvent) => subscriber.error(new Error(data.detail.message))\n\n    const progressHandler = (data: CustomEvent) => {\n      return subscriber.next({type: 'progress', percent: data.detail})\n    }\n\n    const offlineHandler = () => {\n      upchunk.pause()\n      subscriber.next({\n        type: 'pause',\n        id: uuid,\n      })\n    }\n\n    const onlineHandler = () => {\n      upchunk.resume()\n      subscriber.next({\n        type: 'resume',\n        id: uuid,\n      })\n    }\n\n    upchunk.on('success', successHandler)\n    upchunk.on('error', errorHandler)\n    upchunk.on('progress', progressHandler)\n    upchunk.on('offline', offlineHandler)\n    upchunk.on('online', onlineHandler)\n\n    return () => upchunk.abort()\n  })\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;;;;;AAEO,SAASA,uBAAT,CAAiCC,IAAjC,EAA+CC,SAA/C,EAAkEC,MAAlE,EAAgF;EACrF,OAAO,IAAIC,gBAAJ,CAAgBC,UAAD,IAAgB;IACpC,IAAMC,OAAO,GAAGC,OAAO,CAACC,YAAR,CAAqB;MACnCC,QAAQ,EAAEP,SADyB;MAEnCQ,IAAI,EAAEP,MAF6B;MAGnCQ,SAAS,EAAE,KAHwB,CAGjB;;IAHiB,CAArB,CAAhB;;IAMA,IAAMC,cAAc,GAAG,MAAM;MAC3BP,UAAU,CAACQ,IAAX,CAAgB;QACdC,IAAI,EAAE,SADQ;QAEdC,EAAE,EAAEd;MAFU,CAAhB;MAIAI,UAAU,CAACW,QAAX;IACD,CAND;;IAQA,IAAMC,YAAY,GAAIC,IAAD,IAAuBb,UAAU,CAACc,KAAX,CAAiB,IAAIC,KAAJ,CAAUF,IAAI,CAACG,MAAL,CAAYC,OAAtB,CAAjB,CAA5C;;IAEA,IAAMC,eAAe,GAAIL,IAAD,IAAuB;MAC7C,OAAOb,UAAU,CAACQ,IAAX,CAAgB;QAACC,IAAI,EAAE,UAAP;QAAmBU,OAAO,EAAEN,IAAI,CAACG;MAAjC,CAAhB,CAAP;IACD,CAFD;;IAIA,IAAMI,cAAc,GAAG,MAAM;MAC3BnB,OAAO,CAACoB,KAAR;MACArB,UAAU,CAACQ,IAAX,CAAgB;QACdC,IAAI,EAAE,OADQ;QAEdC,EAAE,EAAEd;MAFU,CAAhB;IAID,CAND;;IAQA,IAAM0B,aAAa,GAAG,MAAM;MAC1BrB,OAAO,CAACsB,MAAR;MACAvB,UAAU,CAACQ,IAAX,CAAgB;QACdC,IAAI,EAAE,QADQ;QAEdC,EAAE,EAAEd;MAFU,CAAhB;IAID,CAND;;IAQAK,OAAO,CAACuB,EAAR,CAAW,SAAX,EAAsBjB,cAAtB;IACAN,OAAO,CAACuB,EAAR,CAAW,OAAX,EAAoBZ,YAApB;IACAX,OAAO,CAACuB,EAAR,CAAW,UAAX,EAAuBN,eAAvB;IACAjB,OAAO,CAACuB,EAAR,CAAW,SAAX,EAAsBJ,cAAtB;IACAnB,OAAO,CAACuB,EAAR,CAAW,QAAX,EAAqBF,aAArB;IAEA,OAAO,MAAMrB,OAAO,CAACwB,KAAR,EAAb;EACD,CA5CM,CAAP;AA6CD"}
{"version":3,"file":"extractFiles.js","names":["extractDroppedFiles","dataTransfer","files","Array","from","items","length","Promise","resolve","normalizeItems","then","arr","flat","all","map","item","kind","webkitGetAsEntry","entry","err","getAsFile","isDirectory","walk","file","getAsString","str","File","type","isFile","dir","createReader","readEntries","entries","filter","entr","name","startsWith"],"sources":["../../src/util/extractFiles.ts"],"sourcesContent":["/**\n * Utilities for extracting files from dataTransfer in a predictable cross-browser fashion.\n * Also recursively extracts files from a directory\n * Inspired by https://github.com/component/normalized-upload\n */\n\nexport function extractDroppedFiles(dataTransfer: DataTransfer) {\n  const files = Array.from(dataTransfer.files || [])\n  const items = Array.from(dataTransfer.items || [])\n  if (files && files.length > 0) {\n    return Promise.resolve(files)\n  }\n  return normalizeItems(items).then((arr) => arr.flat())\n}\n\nfunction normalizeItems(items: DataTransferItem[]) {\n  return Promise.all(\n    items.map((item) => {\n      // directory\n      if (item.kind === 'file' && item.webkitGetAsEntry) {\n        let entry: FileSystemEntry | File[]\n        // Edge throws\n        try {\n          entry = item.webkitGetAsEntry()\n        } catch (err) {\n          return [item.getAsFile()]\n        }\n        if (!entry) {\n          return []\n        }\n        return entry.isDirectory ? walk(entry) : [item.getAsFile()]\n      }\n\n      // file\n      if (item.kind === 'file') {\n        const file = item.getAsFile()\n        return Promise.resolve(file ? [file] : [])\n      }\n\n      // others\n      return new Promise((resolve) => item.getAsString(resolve)).then((str?: string) =>\n        str ? [new File([str], 'unknown.txt', {type: item.type})] : []\n      )\n    })\n  )\n}\n\nfunction isFile(entry: FileSystemEntry): entry is FileSystemFileEntry {\n  return entry.isFile\n}\nfunction isDirectory(entry: FileSystemEntry): entry is FileSystemDirectoryEntry {\n  return entry.isDirectory\n}\n\nfunction walk(entry: FileSystemEntry) {\n  if (isFile(entry)) {\n    return new Promise((resolve) => entry.file(resolve)).then((file) => [file])\n  }\n\n  if (isDirectory(entry)) {\n    const dir = entry.createReader()\n    return new Promise((resolve) => dir.readEntries(resolve))\n      .then((entries: FileSystemEntry[]) => entries.filter((entr) => !entr.name.startsWith('.')))\n      .then((entries) => Promise.all(entries.map(walk)).then((arr) => arr.flat()))\n  }\n  return Promise.resolve([])\n}\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEO,SAASA,mBAAT,CAA6BC,YAA7B,EAAyD;EAC9D,IAAMC,KAAK,GAAGC,KAAK,CAACC,IAAN,CAAWH,YAAY,CAACC,KAAb,IAAsB,EAAjC,CAAd;EACA,IAAMG,KAAK,GAAGF,KAAK,CAACC,IAAN,CAAWH,YAAY,CAACI,KAAb,IAAsB,EAAjC,CAAd;;EACA,IAAIH,KAAK,IAAIA,KAAK,CAACI,MAAN,GAAe,CAA5B,EAA+B;IAC7B,OAAOC,OAAO,CAACC,OAAR,CAAgBN,KAAhB,CAAP;EACD;;EACD,OAAOO,cAAc,CAACJ,KAAD,CAAd,CAAsBK,IAAtB,CAA4BC,GAAD,IAASA,GAAG,CAACC,IAAJ,EAApC,CAAP;AACD;;AAED,SAASH,cAAT,CAAwBJ,KAAxB,EAAmD;EACjD,OAAOE,OAAO,CAACM,GAAR,CACLR,KAAK,CAACS,GAAN,CAAWC,IAAD,IAAU;IAClB;IACA,IAAIA,IAAI,CAACC,IAAL,KAAc,MAAd,IAAwBD,IAAI,CAACE,gBAAjC,EAAmD;MACjD,IAAIC,KAAJ,CADiD,CAEjD;;MACA,IAAI;QACFA,KAAK,GAAGH,IAAI,CAACE,gBAAL,EAAR;MACD,CAFD,CAEE,OAAOE,GAAP,EAAY;QACZ,OAAO,CAACJ,IAAI,CAACK,SAAL,EAAD,CAAP;MACD;;MACD,IAAI,CAACF,KAAL,EAAY;QACV,OAAO,EAAP;MACD;;MACD,OAAOA,KAAK,CAACG,WAAN,GAAoBC,IAAI,CAACJ,KAAD,CAAxB,GAAkC,CAACH,IAAI,CAACK,SAAL,EAAD,CAAzC;IACD,CAdiB,CAgBlB;;;IACA,IAAIL,IAAI,CAACC,IAAL,KAAc,MAAlB,EAA0B;MACxB,IAAMO,IAAI,GAAGR,IAAI,CAACK,SAAL,EAAb;MACA,OAAOb,OAAO,CAACC,OAAR,CAAgBe,IAAI,GAAG,CAACA,IAAD,CAAH,GAAY,EAAhC,CAAP;IACD,CApBiB,CAsBlB;;;IACA,OAAO,IAAIhB,OAAJ,CAAaC,OAAD,IAAaO,IAAI,CAACS,WAAL,CAAiBhB,OAAjB,CAAzB,EAAoDE,IAApD,CAA0De,GAAD,IAC9DA,GAAG,GAAG,CAAC,IAAIC,IAAJ,CAAS,CAACD,GAAD,CAAT,EAAgB,aAAhB,EAA+B;MAACE,IAAI,EAAEZ,IAAI,CAACY;IAAZ,CAA/B,CAAD,CAAH,GAAyD,EADvD,CAAP;EAGD,CA1BD,CADK,CAAP;AA6BD;;AAED,SAASC,MAAT,CAAgBV,KAAhB,EAAsE;EACpE,OAAOA,KAAK,CAACU,MAAb;AACD;;AACD,SAASP,WAAT,CAAqBH,KAArB,EAAgF;EAC9E,OAAOA,KAAK,CAACG,WAAb;AACD;;AAED,SAASC,IAAT,CAAcJ,KAAd,EAAsC;EACpC,IAAIU,MAAM,CAACV,KAAD,CAAV,EAAmB;IACjB,OAAO,IAAIX,OAAJ,CAAaC,OAAD,IAAaU,KAAK,CAACK,IAAN,CAAWf,OAAX,CAAzB,EAA8CE,IAA9C,CAAoDa,IAAD,IAAU,CAACA,IAAD,CAA7D,CAAP;EACD;;EAED,IAAIF,WAAW,CAACH,KAAD,CAAf,EAAwB;IACtB,IAAMW,GAAG,GAAGX,KAAK,CAACY,YAAN,EAAZ;IACA,OAAO,IAAIvB,OAAJ,CAAaC,OAAD,IAAaqB,GAAG,CAACE,WAAJ,CAAgBvB,OAAhB,CAAzB,EACJE,IADI,CACEsB,OAAD,IAAgCA,OAAO,CAACC,MAAR,CAAgBC,IAAD,IAAU,CAACA,IAAI,CAACC,IAAL,CAAUC,UAAV,CAAqB,GAArB,CAA1B,CADjC,EAEJ1B,IAFI,CAEEsB,OAAD,IAAazB,OAAO,CAACM,GAAR,CAAYmB,OAAO,CAAClB,GAAR,CAAYQ,IAAZ,CAAZ,EAA+BZ,IAA/B,CAAqCC,GAAD,IAASA,GAAG,CAACC,IAAJ,EAA7C,CAFd,CAAP;EAGD;;EACD,OAAOL,OAAO,CAACC,OAAR,CAAgB,EAAhB,CAAP;AACD"}